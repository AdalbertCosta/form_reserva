<!DOCTYPE html>
<html lang="pt-br">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Solicitação de Demandas - Reserva</title>
  <link rel="stylesheet" href="css/style.css">
</head>
<body>
  <main>
    <section>
      <h1>Formulário de Solicitação de Demandas</h1>
      <form id="demandaForm">
        <label for="nome">Nome do Solicitante *</label>
        <input type="text" id="nome" name="nome" required>

        <label for="numero">Número da Casa *</label>
        <input type="text" id="numero" name="numero" required>

        <label for="whatsapp">WhatsApp</label>
        <input type="text" id="whatsapp" name="whatsapp">

        <label for="email">E-mail</label>
        <input type="email" id="email" name="email">

        <label for="tipo_pessoa">Perfil *</label>
        <select id="tipo_pessoa" name="tipo_pessoa" required>
          <option value="Proprietário">Proprietário</option>
          <option value="Inquilino">Inquilino</option>
        </select>

        <label for="tipo_solicitacao">Tipo de Solicitação *</label>
        <select id="tipo_solicitacao" name="tipo_solicitacao" required>
          <option value="Solicitação de Reparos/Serviços">Solicitação de Reparos/Serviços</option>
          <option value="Informe/Relato">Informe/Relato</option>
          <option value="Agendamento Salão de Festas">Agendamento Salão de Festas</option>
          <option value="Sugestão de Melhoria">Sugestão de Melhoria</option>
          <option value="Pedido de Informação">Pedido de Informação</option>
        </select>

        <label for="descricao">Descrição da Solicitação *</label>
        <textarea id="descricao" name="descricao" rows="4" required></textarea>

        <button type="submit">Enviar Solicitação</button>
      </form>
    </section>
  </main>

  <script type="module">
    // Pegando variáveis de ambiente do Netlify
    const SUPABASE_URL = import.meta.env.VITE_SUPABASE_URL;
    const SUPABASE_KEY = import.meta.env.VITE_SUPABASE_KEY;

    const form = document.getElementById("demandaForm");

    form.addEventListener("submit", async (e) => {
      e.preventDefault();

      const dados = {
        nome_solicitante: document.getElementById("nome").value,
        numero_casa: document.getElementById("numero").value,
        whatsapp: document.getElementById("whatsapp").value,
        email: document.getElementById("email").value,
        tipo_pessoa: document.getElementById("tipo_pessoa").value,
        tipo_solicitacao: document.getElementById("tipo_solicitacao").value,
        descricao: document.getElementById("descricao").value,
        created_at: new Date().toISOString()
      };

      try {
        const response = await fetch(`${SUPABASE_URL}/rest/v1/demandas`, {
          method: "POST",
          headers: {
            apikey: SUPABASE_KEY,
            Authorization: "Bearer " + SUPABASE_KEY,
            "Content-Type": "application/json",
            Prefer: "return=minimal"
          },
          body: JSON.stringify(dados)
        });

        if (response.ok) {
          alert("✅ Solicitação enviada com sucesso!");
          form.reset();
        } else {
          const erro = await response.json();
          console.error("Erro:", erro);
          alert("❌ Erro ao enviar a solicitação. Verifique o console.");
        }
      } catch (err) {
        console.error("Erro inesperado:", err);
        alert("❌ Falha na conexão com o servidor.");
      }
    });
  </script>
</body>
</html>
