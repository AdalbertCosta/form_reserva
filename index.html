<script>
  const SUPABASE_URL = "https://imfmysuckcqocfrifele.supabase.co";
  const SUPABASE_KEY = "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImltZm15c3Vja2Nxb2NmcmlmZWxlIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTc5NzE4OTksImV4cCI6MjA3MzU0Nzg5OX0.adD92pCg4q3l6VlIdUby3ozD4l_HyvY2xMrygT3LxF8";

  const form = document.getElementById("demandaForm"); // mantém seu ID do formulário
  const botao = form.querySelector("button[type='submit']");

  form.addEventListener("submit", async function (e) {
    e.preventDefault();

    botao.disabled = true;
    botao.textContent = "Enviando...";

    const dados = {
      nome_solicitante: document.getElementById("nome").value.trim(),
      numero_casa: document.getElementById("numero").value.trim(),
      whatsapp: document.getElementById("whatsapp").value.trim(),
      email: document.getElementById("email").value.trim(),
      tipo_pessoa: document.getElementById("tipo_pessoa").value,
      tipo_solicitacao: document.getElementById("tipo_solicitacao").value,
      descricao: document.getElementById("descricao").value.trim(),
      created_at: new Date().toISOString()
    };

    try {
      const response = await fetch(`${SUPABASE_URL}/rest/v1/demandas`, {
        method: "POST",
        headers: {
          apikey: SUPABASE_KEY,
          Authorization: "Bearer " + SUPABASE_KEY,
          "Content-Type": "application/json",
          Prefer: "return=minimal"
        },
        body: JSON.stringify(dados)
      });

      if (response.ok) {
        alert("✅ Solicitação enviada com sucesso!");
        form.reset();
      } else {
        const erro = await response.text();
        console.error("Erro:", erro);
        alert("❌ Erro ao enviar. Veja o console.");
      }
    } catch (err) {
      console.error("Erro inesperado:", err);
      alert("❌ Erro de conexão com o servidor.");
    } finally {
      botao.disabled = false;
      botao.textContent = "Enviar Solicitação";
    }
  });
</script>
